{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/michalradacz/database-editor/jsondb-schema.json",
  "title": "JSONDB Database Schema",
  "description": "Schema for JSONDB database format used by DataForge editor. Includes DataForge extensions for collections, notes, views, and record locking.",
  "type": "object",
  "required": ["meta", "tables"],
  "properties": {
    "meta": {
      "type": "object",
      "description": "Database metadata and settings",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Database name"
        },
        "columnVisibility": {
          "type": "object",
          "description": "Column visibility settings per table",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": {
              "type": "boolean"
            }
          }
        },
        "groupStates": {
          "type": "object",
          "description": "Group expansion states per table",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": {
              "type": "boolean"
            }
          }
        },
        "collections": {
          "type": "array",
          "description": "DataForge extension: Collections for organizing records across tables",
          "items": {
            "$ref": "#/definitions/collection"
          }
        },
        "tags": {
          "type": "array",
          "description": "DataForge extension: Tags for labeling records",
          "items": {
            "$ref": "#/definitions/tag"
          }
        },
        "views": {
          "type": "object",
          "description": "DataForge extension: Saved filter views per table",
          "additionalProperties": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/view"
            }
          }
        },
        "notes": {
          "type": "array",
          "description": "DataForge extension: Notes attached to records",
          "items": {
            "$ref": "#/definitions/note"
          }
        }
      }
    },
    "tables": {
      "type": "array",
      "description": "Array of database tables",
      "items": {
        "$ref": "#/definitions/table"
      }
    }
  },
  "definitions": {
    "table": {
      "type": "object",
      "required": ["id", "name", "fields", "records"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique table identifier",
          "pattern": "^id_[a-z0-9]+$"
        },
        "name": {
          "type": "string",
          "description": "Table display name"
        },
        "showInSimpleMode": {
          "type": "boolean",
          "description": "DataForge extension: Whether table is visible in simple mode",
          "default": true
        },
        "fields": {
          "type": "array",
          "description": "Table field definitions",
          "items": {
            "$ref": "#/definitions/field"
          }
        },
        "records": {
          "type": "array",
          "description": "Table records",
          "items": {
            "$ref": "#/definitions/record"
          }
        }
      }
    },
    "field": {
      "type": "object",
      "required": ["id", "name", "type"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique field identifier",
          "pattern": "^id_[a-z0-9]+$"
        },
        "name": {
          "type": "string",
          "description": "Field display name"
        },
        "type": {
          "type": "string",
          "description": "Field data type",
          "enum": ["text", "textarea", "number", "date", "url", "boolean", "select", "composite", "parent", "children"]
        },
        "primary": {
          "type": "boolean",
          "description": "Whether this is the primary display field",
          "default": false
        },
        "filter": {
          "type": "boolean",
          "description": "Whether filtering by this field is enabled",
          "default": false
        },
        "group": {
          "type": "boolean",
          "description": "Whether grouping by this field is enabled",
          "default": false
        },
        "options": {
          "type": "string",
          "description": "Comma-separated options for select field type"
        },
        "template": {
          "type": "string",
          "description": "Template string for composite field type using {FieldName} placeholders"
        },
        "targetTableId": {
          "type": "string",
          "description": "Target table ID for parent/children field types"
        },
        "parentFieldId": {
          "type": "string",
          "description": "Parent field ID in target table for children field type"
        }
      }
    },
    "record": {
      "type": "object",
      "required": ["id", "values"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique record identifier",
          "pattern": "^id_[a-z0-9]+$"
        },
        "values": {
          "type": "object",
          "description": "Field values keyed by field ID",
          "additionalProperties": true
        },
        "locked": {
          "type": "boolean",
          "description": "DataForge extension: Whether record is locked for editing",
          "default": false
        }
      }
    },
    "collection": {
      "type": "object",
      "description": "DataForge extension: Collection for grouping records",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique collection identifier",
          "pattern": "^id_[a-z0-9]+$"
        },
        "name": {
          "type": "string",
          "description": "Collection display name"
        },
        "description": {
          "type": "string",
          "description": "Collection description"
        },
        "color": {
          "type": "string",
          "description": "Collection color (hex format)",
          "pattern": "^#[0-9a-fA-F]{6}$"
        },
        "members": {
          "type": "array",
          "description": "Array of record references in collection",
          "items": {
            "type": "object",
            "required": ["tableId", "recordId"],
            "properties": {
              "tableId": {
                "type": "string"
              },
              "recordId": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "tag": {
      "type": "object",
      "description": "DataForge extension: Tag for labeling records",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique tag identifier",
          "pattern": "^id_[a-z0-9]+$"
        },
        "name": {
          "type": "string",
          "description": "Tag display name"
        },
        "color": {
          "type": "string",
          "description": "Tag color (hex format)",
          "pattern": "^#[0-9a-fA-F]{6}$"
        },
        "records": {
          "type": "array",
          "description": "Array of record references with this tag",
          "items": {
            "type": "object",
            "required": ["tableId", "recordId"],
            "properties": {
              "tableId": {
                "type": "string"
              },
              "recordId": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "view": {
      "type": "object",
      "description": "DataForge extension: Saved filter view",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique view identifier",
          "pattern": "^id_[a-z0-9]+$"
        },
        "name": {
          "type": "string",
          "description": "View display name"
        },
        "filters": {
          "type": "object",
          "description": "Field filters keyed by field ID",
          "additionalProperties": {
            "type": "string"
          }
        },
        "collectionFilter": {
          "type": "string",
          "description": "Collection filter ID"
        },
        "tagFilter": {
          "type": "string",
          "description": "Tag filter ID"
        }
      }
    },
    "note": {
      "type": "object",
      "description": "DataForge extension: Note attached to a record",
      "required": ["id", "tableId", "recordId", "text"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique note identifier",
          "pattern": "^id_[a-z0-9]+$"
        },
        "tableId": {
          "type": "string",
          "description": "Table ID of the record this note is attached to"
        },
        "recordId": {
          "type": "string",
          "description": "Record ID this note is attached to"
        },
        "text": {
          "type": "string",
          "description": "Note text content"
        },
        "resolved": {
          "type": "boolean",
          "description": "Whether the note is marked as resolved",
          "default": false
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Note creation timestamp"
        }
      }
    }
  }
}
